<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<title>Python в браузере</title>

		<link rel="stylesheet" href="css/reset.css">
		<link rel="stylesheet" href="css/reveal.css">
		<link rel="stylesheet" href="css/theme/sky.css">
		<link rel="stylesheet" href="css/custom.css">

		<!-- Theme used for syntax highlighting of code -->
		<link rel="stylesheet" href="lib/css/github.css">

		<!-- Printing and PDF exports -->
		<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script>
	</head>
	<body>
		<div class="reveal">
			<div class="slides">
				<section>
					<h1><strong>Python</strong> в&nbsp;браузере</h1>
					<div>Brython и Pyodide</div>
					<div class="logo--antida">
						<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" width="38.531mm" height="38.531mm" version="1.1" style="shape-rendering:geometricPrecision; text-rendering:geometricPrecision; image-rendering:optimizeQuality; fill-rule:evenodd; clip-rule:evenodd" viewBox="0 0 38531 38531">
							<path class="fil0" d="M14630 3644l-4511 12316 -8718 0 -1401 0 0 4194 0 2683 7600 0 -4414 12051 7438 0 2024 -5485 11926 0 2024 5485 7432 0 -11487 -31244 -7913 0zm6404 19193l0 0 -1695 0 -959 0 -7487 0 0 -6877 9944 0 196 0 0 6877z"/>
							<polygon class="fil0" points="38530,15960 32786,15960 31938,15960 31938,20154 31938,22837 38530,22837 "/>
						</svg>
					</div>	
				</section>
				<section>
          <section>
          <h2>Популярность<br/> <strong>Python</strong></h2>
          <ul>
            <li class="fragment" data-fragment-index="0">Web</li>
            <li class="fragment" data-fragment-index="1">Data Science</li>
            <li class="fragment" data-fragment-index="2">Newbies</li>
          </ul>
				  </section>
          <section>
            <h2>Web</h2>
            <img data-src="./img/flask.svg" />
            <div><a class="github-button" href="https://github.com/pallets/flask" data-icon="octicon-star" data-size="large" data-show-count="true"></a></div>
          </section>
          <section>
            <h2>Web</h2>
            <img data-src="./img/django.svg" />
            <div><a class="github-button" href="https://github.com/django/django" data-icon="octicon-star" data-size="large" data-show-count="true"></a></div>
          </section>
          <section>
            <h2>Web</h2>
            <img data-src="./img/tornado.png" height="100"/>
            <div><a class="github-button" href="https://github.com/tornadoweb/tornado" data-icon="octicon-star" data-size="large" data-show-count="true"></a></div>
          </section>
          <section>
            <h2>Data Science</h2>
            <img data-src="./img/keras.png" />
            <div><a class="github-button" href="https://github.com/keras-team/keras" data-icon="octicon-star" data-size="large" data-show-count="true"></a></div>
          </section>
          <section>
            <h2>Data Science</h2>
            <img data-src="./img/ipython.png" />
            <div><a class="github-button" href="https://github.com/ipython/ipython" data-icon="octicon-star" data-size="large" data-show-count="true"></a></div>
          </section>
          <section>
            <h2>Data Science</h2>
            <img data-src="./img/numpy.svg" />
            <div><a class="github-button" href="https://github.com/numpy/numpy" data-icon="octicon-star" data-size="large" data-show-count="true"></a></div>
          </section>
          <section>
            <h2>Data Science</h2>
            <img data-src="./img/matpotlib.webp" />
            <div><a class="github-button" href="https://github.com/matplotlib/matplotlib" data-icon="octicon-star" data-size="large" data-show-count="true"></a></div>
          </section>
          <section>
            <h2>Newbies</h2>
            <h3>MCPI</h3>
            <img data-src="./img/minecraft_logo.png" height="400"/>
          </section>
          <section data-background-image="./img/mcpi_hello.gif">
          </section>
        </section>
        <section>
          <h2>Python ⇨ Browser</h2>
          <p><strong>Brython</strong> — виртуальная машина Python, написанная на Javascript.</p>
          <p>Позволяет запустить код на Python 3<br/> в веб-браузере.</p>
        </section>
        <section>
          <h2>Brython</h2>
          <ol>
              <li>Добавить скрипт brython.js</li>
              <li>Добавить к body атрибут onload со значением brython() </li>
              <li>Писать Python код внутри <br/><code>&lt;script type="text/python"&gt;</code>
            </li>
          </ol>
              <pre><code data-line-numbers>  &lt;script type="text/python">
    # PYTHON CODE
  &lt;/script>
              </code></pre>
        </section>
        <section>
          <section>
            <h2>Brython Hello World</h2>
            <h3>PY</h3>
            <pre>
              <code data-line-numbers>  from browser import document, alert
  
  def echo(ev):
      alert(f'Hello {document["input"].value}!')
  
  document["button"].bind("click", echo)
              </code>
            </pre>
          </section>
          <section>
              <h2>Brython Hello World</h2>
              <h3>HTML</h3>

              <pre>
                <code>  &ltinput id="input" value="World">
  &ltbutton id="button">click!&lt/button>                
                </code>
            </pre>
          </section>
          <section data-state="full">
              <a href="http://jsbin.com/cutijex/1/edit?html,output" target="_blank"><h3>Brython Hello World</h3></a>
              <a class="jsbin-embed" href="http://jsbin.com/cutijex/1/embed?html,output">JS Bin on jsbin.com</a>
          </section>
        </section>
        <section>
          <section>
            <h2>Brython Insert Element</h2>
            <h3>PY</h3>
            <pre>
              <code class="hljs" data-line-numbers>from browser import document, html

element = document["zone6"]
nb = 0

def change(event):
    global nb
    element &lt;= html.LI(f" {nb}")
    nb += 1

document["button6"].bind("click", change)        
              </code>
            </pre>
          </section>
          <section>
            <h2>Brython Insert Element</h2>
            <h3>PY</h3>
            <pre>
              <code class="hljs" data-line-numbers="8">from browser import document, html

element = document["zone6"]
nb = 0

def change(event):
    global nb
    element &lt;= html.LI(f" {nb}")
    nb += 1

document["button6"].bind("click", change)        
              </code>
            </pre>
          </section>
          <section class="stack" data-state="full">
              <a href="http://jsbin.com/retojar/1/edit?html,output" target="_blank"><h3>Brython Insert Element</h3></a>
              <a class="jsbin-embed" href="http://jsbin.com/retojar/embed?html,output">JS Bin on jsbin.com</a>
          </section>
        </section>
        <section>
          <section>
            <h2>Brython Async</h2>
            <pre>
              <code class="hljs" data-line-numbers>from browser import document, html, aio

async def main():
    pychel_banner_vk = "https://sun9-1.userapi.com/c851032/v851032348/ca167/zpzNgmKgUQY.jpg"
    req = await aio.get(pychel_banner_vk, format="dataURL")
    document <= html.IMG(src=req.data)

aio.run(main())
              </code>
            </pre>
          </section>
          <section data-state="full">
              <a href="http://jsbin.com/heravos/1/edit?html,output" target="_blank"><h3>Brython Async</h3></a>
              <a class="jsbin-embed" href="http://jsbin.com/heravos/embed?html,output">JS Bin on jsbin.com</a>
          </section>
        </section>
        <section>
          <section>
            <h2 class="fragment" data-fragment-index="0">Зачем же мне <strong>Python</strong></h2>
            <h2 class="fragment" data-fragment-index="1">в браузере?</h2>
          </section>
          <section>
            <h2 class="fragment" data-fragment-index="0">A/B experiments CIAN</h2>
            <h2 class="fragment" data-fragment-index="1">Доклад Ивана Бабкова на эту тему</h2>
            <div class="fragment" data-fragment-index="1"><a href="http://frontendconf.ru/moscow-rit/2019/abstracts/5124" target="_blank">Как разрабатывать сотни A/B-экспериментов</a></div>
          </section>
          <section>
            <ol>
              <li class="fragment" data-fragment-index="0">Cгенерировать 2 бакета с группами</li>
              <li class="fragment" data-fragment-index="1">Разделить массив от 1 до 100 на 2 бакета</li>
              <li class="fragment" data-fragment-index="2">...</li>
              <li class="fragment" data-fragment-index="3">Я сделаю с помощью Python это за 5 строчек</li>
              <div class="text-center">
                <img class="fragment" data-fragment-index="3" data-src="./img/ugaday.png" />
              </div>
            </ol>
          </section>
          <section>
            <h2>Те самые 5 строк</h2>
            <pre>
              <code class="hljs" data-line-numbers>import random
all = range(0, 100)
active = random.sample(all, 50)
active.sort()
inactive = list(set(all) - set(active))
              </code>
            </pre>
          </section>
        </section>
        <section>
          <section>
            <h2>Brython Generate Buckets</h2>
            <pre>
              <code class="hljs" data-line-numbers>from browser import document, html
from random import sample

buckets = Buckets()

def add_text(value):
    text = document.querySelector('textarea')
    text.value = value

def print_buckets():
    [first, second] = buckets.get_buckets(int(document["num"].value))
    add_text(f'First Bucket:\n{first}\n\nSecond Bucket:\n{second}')

document["button"].bind("click", print_buckets)
              </code>
            </pre>
          </section>
          <section>
            <h2>Brython Generate Buckets</h2>
            <pre>
              <code class="hljs" data-line-numbers>from browser import document, html
class Buckets(object):
  def __init__(self):
    self.start_input = document.getElementById('start')
    self.end_input = document.getElementById('end')

  @property
  def start(self):
    return int(self.start_input.value)

  @property
  def end(self):
    return int(self.end_input.value)

  def get_buckets(self, num):
    all = list(range(self.start, self.end))
    active = sample(all, num)
    active.sort()
    inactive = list(set(all) - set(active))
    return [inactive, active]
              </code>
            </pre>
          </section>
          <section data-state="full">
              <a href="http://jsbin.com/mecixer/1/edit?html,output" target="_blank"><h3>Brython Generate Buckets</h3></a>
            <a class="jsbin-embed" href="http://jsbin.com/mecixer/embed?html,output">JS Bin on jsbin.com</a>
          </section>
        </section>
        <section>
            <h2>Brython Online</h2>
            <ol>
              <li><a href="http://brython.info/tests/editor.html" target="_blank">Editor</a></li>
              <li><a href="http://brython.info/tests/console.html" target="_blank">Console</a></li>
              <li><a href="http://brython.info/gallery/gallery_en.html" target="_blank">Gallery of examples</a></li>
            </ol>
        </section>
        <section>
            <h2>Python ⇨ Browser</h2>
            <p><strong>Pyodide</strong> — скомпилированный научный стек Python для запуска в WebAssembly.</p>
            <p><div>&nbsp;</div><div>&nbsp;</div></p>
          </section>
        <section>
          <section>
            <h2>WebAssembly (wasm)</h2>
            <ul>
              <li>бинарный формат инструкций для стековой виртуальной машины.</li>
              <li>проектирован как портативная цель компиляции для высокоуровневых языков, таких как C/C++/Rust, которую можно развертывать в web для клиентских и серверных приложений.</li>
            </ul>
            <img data-src="./img/webassembly.svg" />
          </section>
          <section>
            <h2>WebAssembly CanIUse</h2>
            <a href="https://caniuse.com/#feat=wasm" target="_blank"><img data-src="./img/webassembly_caniuse.png" /></a>
          </section>
        </section>
        <section>
          <section>
            <h2>Pyodide Example</h2>
        
            <pre>
              <code class="hljs" data-line-numbers>from js import document, iodide
canvas = iodide.output.element('canvas')
canvas.setAttribute('width', 450)
canvas.setAttribute('height', 300)
context = canvas.getContext("2d")
context.strokeStyle = "#df4b26"
context.lineJoin = "round"
context.lineWidth = 5

pen = False
lastPoint = (0, 0)

canvas.addEventListener('mousemove', onmousemove)
canvas.addEventListener('mousedown', onmousedown)
canvas.addEventListener('mouseup', onmouseup)
              </code>
            </pre>
          </section>
          <section>
            <h2>Pyodide Example</h2>
        
            <pre>
              <code class="hljs" data-line-numbers>def onmousemove(e):
    global lastPoint

    if pen:
        newPoint = (e.offsetX, e.offsetY)
        context.beginPath()
        context.moveTo(lastPoint[0], lastPoint[1])
        context.lineTo(newPoint[0], newPoint[1])
        context.closePath()
        context.stroke()
        lastPoint = newPoint

def onmousedown(e):
    global pen, lastPoint
    pen = True
    lastPoint = (e.offsetX, e.offsetY)

def onmouseup(e):
    global pen
    pen = False
              </code>
            </pre>
          </section>
          <section data-background-image="./img/pyodide-draw.gif"></section>
        </section>
        <section>
          <section>
            <h2>Pyodide из Iodide</h2>
            <pre>
              <code class="hljs" data-line-numbers>%% fetch
// load a js library and a csv file with a fetch cell
js: https://cdnjs.cloudflare.com/ajax/libs/d3/4.10.2/d3.js
text: csvDataString = https://data.sfgov.org/api/views/5cei-gny5/rows.csv?accessType=DOWNLOAD

%% js
// parse the data using the d3 library (and show the value in the console)
parsedData = d3.csvParse(csvDataString)

%% js
// replace the text in the report element "htmlInMd"
document.getElementById('htmlInMd').innerText = parsedData[0].Address

%% py
# use python to select some of the data
from js import parsedData
[x['Address'] for x in parsedData if x['Lead Remediation'] == 'true']
              </code>
            </pre>
          </section>
          <section>
            <h2>Pyodide из JS</h2>
            <pre>
              <code class="hljs" data-line-numbers>languagePluginLoader.then(() => {
  // pyodide is now ready to use...
  console.log(pyodide.runPython('import sys\nsys.version'));
});
              </code>
            </pre>
          </section>
        </section>
        <section>
          <h2>Что есть из коробки в Pyodide?</h2>
          <ul>
            <li>NumPy</li>
            <li>Pandas</li>
            <li>Matplotlib</li>
            <li>SciPy (partially)</li>
            <li>NetworkX</li>
            <li>Jinja2</li>
          </ul>
        </section>
        <section>
          <section>
          <h2>Что не работает в Pyodide</h2>
          <h3>Probably never</h3>
          <ul>
            <li>Raw network sockets</li>
            <li>Subprocesses</li>
            <li>Raw filesystem access</li>
          </ul>
        </section>
          <section>
            <h2>Что не работает в Pyodide</h2>
            <h3>Should work someday</h3>
            <ul>
              <li>threads</li>
              <li>async</li>
            </ul>
          </section>
        </section>
        <section>
          <section>
            <h2>Jinja time!</h2>
          </section>
          <section>
            <h2>PY</h2>
            <pre><code data-line-numbers>obj = [{'title': 'title'}, {'title': 'AnOtHer tITle'}]
main_title = 'Print Me, please'

def truncate_text(s, l = 10):
    return s[0:l-3] + '...' if len(s) > l else s

def reverse_filter(s):
    return s[::-1]

env.filters['reverse_filter'] = reverse_filter
            </code></pre>
          </section>
          <section>
              <h2>Template</h2>
              <pre><code data-line-numbers>&lt;h1>{{main_title|reverse_filter}}&lt;/h1>
{% for o in obj %}
&lt;p>
  &lt;span>({{loop.index}})&lt;/span>
  &lt;span>{{o.title|striptags|title}}&lt;/span>
&lt;/p>
{% endfor %}                  
              </code>
            </pre>
          </section>
          <section data-state="full">
            <iframe data-src="./pyodide.html" width="100%"></iframe>
          </section>
        </section>
        <section><h2>Спасибо за внимание</h2></section>
			</div>
		</div>

    <script src="js/reveal.js"></script>
    <script src="https://static.jsbin.com/js/embed.min.js?4.1.7"></script>

		<script>
			// More info about config & dependencies:
			// - https://github.com/hakimel/reveal.js#configuration
			// - https://github.com/hakimel/reveal.js#dependencies
			Reveal.initialize({
				dependencies: [
					{ src: 'plugin/markdown/marked.js' },
					{ src: 'plugin/markdown/markdown.js' },
					{ src: 'plugin/notes/notes.js', async: true },
					{ src: 'plugin/highlight/highlight.js', async: true }
				]
			});
    </script>
    <script async defer src="https://buttons.github.io/buttons.js"></script>
	</body>
</html>
